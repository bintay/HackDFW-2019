<!DOCTYPE html>
<html>
<head>
   <title>Homelessn't</title>
   <meta charset='utf8' />
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <link href="https://fonts.googleapis.com/css?family=Quicksand:400,700|Source+Sans+Pro" rel="stylesheet" />
   <link rel='stylesheet' type='text/css' href='/public/css/main.css' />
   <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
</head>
<body>
   <header>
      <div class="wrap">
         <div class="grid2-2">
            <a href="/" class='no-a'>
               <div class="col1">
                  <h1>Homelessn't üè°</h1>
                  <h2>That ain't it chief</h2>
               </div>
            </a>
            <div class="col2-2">
               <span class='right'>
               {{#if loggedOut}}
                  <a href="/login" class='right'>Login</a>
               {{else}}
                  {{#if canAdd}}
                     <a href='/manage' class='no-mobile'>Manage Libraries</a><span class='no-mobile'> / </span>
                     <a href='/add' class='no-mobile'>Add Volunteering</a><span class='no-mobile'> / </span><a href="/profile/">Profile</a> / <a href="/logout/">Log Out</a>
                  {{else}}
                     <a href="/profile/">Profile</a> / <a href="/logout/">Log Out</a>
                  {{/if}}
               {{/if}}
               </span>
            </div>
         </div>
      </div>
   </header>
   <div id="app">
      <div class="wrap">
         <div class="error" v-for='err in errors'>Error: \{{err}}</div>
         <div class="card" v-for='event in volunteer'>
            <div class="grid2">
               <div class="col1">
                  <span class='title'>\{{ event.title }}</span><br><br>
                  <span class='grey'>\{{ event.location }}</span><br>
                  <span class="grey">\{{ (new Date(event.date)).toDateString() }}</span><br><br>
                  <span class="grey">\{{ event.people }} / \{{ event.needPeople }} volunteers signed up</span>
                  <br>
                  <br>
               </div>
               <div class="col2">
                  \{{ event.description }}
                  <br>
                  <br>
                  {{#if loggedOut}}
                     <button class='button' disabled>Login to Volunteer</button>
                  {{else}}
                     <button v-if='!signedUp[event._id]' class="button" @click='joinVolunteer(event)'>Volunteer</button>
                     <button v-if='signedUp[event._id]' class='button' disabled>You're signed up</button>
                  {{/if}}
               </div>
            </div>
         </div>
      </div>
   </div>
   <footer>
      <p class="center">&copy; Humanity, 2019 üíõ</p>
   </footer>
   <script
           src="https://code.jquery.com/jquery-3.3.1.min.js"
           integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
           crossorigin="anonymous"></script>
   <script>
      function httpGet(theUrl)
      {
         var xmlHttp = new XMLHttpRequest();
         xmlHttp.open( "GET", theUrl, false ); // false for synchronous request
         xmlHttp.send( null );
         return xmlHttp.responseText;
      }

      const app = new Vue({
         el: '#app',
         data: {
            message: 'Hello Vue!',
            errors: [],
            signedUp: {{{signedUp}}}
         },
         computed: {
            volunteer: function () {
               return JSON.parse(httpGet('http://localhost:4321/api/volunteerings/'));
               // return [
               //    {
               //       title: 'Training: Web Development üíª',
               //       location: '3800 Parry Ave, Dallas, TX',
               //       description: 'Help us get people back on their feet by teaching how to develop and deploy a website!',
               //       date: '4:00pm, Feb 17, 2018',
               //       people: 0,
               //       needPeople: 4
               //    },
               //    {
               //       title: 'Training: Working With Wood üî®',
               //       location: '3801 Party Ave, Dallas, TX',
               //       description: 'Help us get people back on their feet by teaching how to work with wood!',
               //       date: '4:00pm, Feb 19, 2018',
               //       people: 0,
               //       needPeople: 4
               //    },
               //    {
               //       title: 'Training: English as a Second Language üí¨',
               //       location: '3802 Pretty Ave, Dallas, TX',
               //       description: 'Help us get people back on their feet by teaching English!',
               //       date: '4:00pm, Feb 21, 2018',
               //       people: 0,
               //       needPeople: 4
               //    },
               //    {
               //       title: 'Dallas Food Bank üçî',
               //       location: '3803 Purty Ave, Dallas, TX',
               //       description: 'Help make sure everyone has food on their table by volunteering with the food bank!',
               //       date: '4:00pm, Feb 23, 2018',
               //       people: 0,
               //       needPeople: 8
               //    },
               // ]
            }
         },
         methods: {
            joinVolunteer: function (event) {
               let vThis = this;
               $.post('http://localhost:4321/join/', {volID: event._id}).done(function (res) {
                  let data = JSON.parse(res);
                  if (data.done) location.reload();
                  else {
                     vThis.errors = data;
                     vThis.$forceUpdate();
                  }
               });
            }
         }
      });
   </script>
</body>
</html>